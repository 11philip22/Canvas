#! /usr/bin/env python


#Proprietary CANVAS source code - use only under the license agreement
#specified in LICENSE.txt in your CANVAS distribution
#Copyright Immunity, Inc, 2002-2006
#http://www.immunityinc.com/CANVAS/ for more information




#This lib will provide necesary functions for exploit dialogs creation



def generateDefaultDialog(filepath,port,host,targets):
  filepath=filepath+"dialog.glade2"
  print "Generating default exploit dialog into %s..." % filepath
  f=open(filepath,"w")
  templatebuf=[]
  templatebuf+= ['<?xml version="1.0" standalone="no"?> <!--*- mode: xml -*-->\n']
  templatebuf+= ['<!DOCTYPE glade-interface SYSTEM "http://glade.gnome.org/glade-2.0.dtd">\n']
  templatebuf+= ['\n']
  templatebuf+= ['<glade-interface>\n']
  templatebuf+= ['\n']
  templatebuf+= ['<widget class="GtkDialog" id="exploit_dialog">\n']
  templatebuf+= ['  <property name="visible">True</property>\n']
  templatebuf+= ['  <property name="title" translatable="yes">Exploit Dialog</property>\n']
  templatebuf+= ['  <property name="type">GTK_WINDOW_TOPLEVEL</property>\n']
  templatebuf+= ['  <property name="window_position">GTK_WIN_POS_NONE</property>\n']
  templatebuf+= ['  <property name="modal">False</property>\n']
  templatebuf+= ['  <property name="resizable">True</property>\n']
  templatebuf+= ['  <property name="destroy_with_parent">False</property>\n']
  templatebuf+= ['  <property name="decorated">True</property>\n']
  templatebuf+= ['  <property name="skip_taskbar_hint">False</property>\n']
  templatebuf+= ['  <property name="skip_pager_hint">False</property>\n']
  templatebuf+= ['  <property name="type_hint">GDK_WINDOW_TYPE_HINT_DIALOG</property>\n']
  templatebuf+= ['  <property name="gravity">GDK_GRAVITY_NORTH_WEST</property>\n']
  templatebuf+= ['  <property name="focus_on_map">True</property>\n']
  templatebuf+= ['  <property name="urgency_hint">False</property>\n']
  templatebuf+= ['  <property name="has_separator">True</property>\n']
  templatebuf+= ['\n']
  templatebuf+= ['  <child internal-child="vbox">\n']
  templatebuf+= ['    <widget class="GtkVBox" id="dialog-vbox1">\n']
  templatebuf+= ['      <property name="visible">True</property>\n']
  templatebuf+= ['      <property name="homogeneous">False</property>\n']
  templatebuf+= ['      <property name="spacing">0</property>\n']
  templatebuf+= ['\n']
  templatebuf+= ['      <child internal-child="action_area">\n']
  templatebuf+= ['	<widget class="GtkHButtonBox" id="dialog-action_area1">\n']
  templatebuf+= ['	  <property name="visible">True</property>\n']
  templatebuf+= ['	  <property name="layout_style">GTK_BUTTONBOX_END</property>\n']
  templatebuf+= ['\n']
  templatebuf+= ['	  <child>\n']
  templatebuf+= ['	    <widget class="GtkButton" id="cancelbutton1">\n']
  templatebuf+= ['	      <property name="visible">True</property>\n']
  templatebuf+= ['	      <property name="can_default">True</property>\n']
  templatebuf+= ['	      <property name="can_focus">True</property>\n']
  templatebuf+= ['	      <property name="label">gtk-cancel</property>\n']
  templatebuf+= ['	      <property name="use_stock">True</property>\n']
  templatebuf+= ['	      <property name="relief">GTK_RELIEF_NORMAL</property>\n']
  templatebuf+= ['	      <property name="focus_on_click">True</property>\n']
  templatebuf+= ['	      <property name="response_id">-6</property>\n']
  templatebuf+= ['	    </widget>\n']
  templatebuf+= ['	  </child>\n']
  templatebuf+= ['\n']
  templatebuf+= ['	  <child>\n']
  templatebuf+= ['	    <widget class="GtkButton" id="okbutton1">\n']
  templatebuf+= ['	      <property name="visible">True</property>\n']
  templatebuf+= ['	      <property name="can_default">True</property>\n']
  templatebuf+= ['	      <property name="can_focus">True</property>\n']
  templatebuf+= ['	      <property name="label">gtk-ok</property>\n']
  templatebuf+= ['	      <property name="use_stock">True</property>\n']
  templatebuf+= ['	      <property name="relief">GTK_RELIEF_NORMAL</property>\n']
  templatebuf+= ['	      <property name="focus_on_click">True</property>\n']
  templatebuf+= ['	      <property name="response_id">-5</property>\n']
  templatebuf+= ['	    </widget>\n']
  templatebuf+= ['	  </child>\n']
  templatebuf+= ['	</widget>\n']
  templatebuf+= ['	<packing>\n']
  templatebuf+= ['	  <property name="padding">0</property>\n']
  templatebuf+= ['	  <property name="expand">False</property>\n']
  templatebuf+= ['	  <property name="fill">True</property>\n']
  templatebuf+= ['	  <property name="pack_type">GTK_PACK_END</property>\n']
  templatebuf+= ['	</packing>\n']
  templatebuf+= ['      </child>\n']
  templatebuf+= ['\n']
  templatebuf+= ['      <child>\n']
  templatebuf+= ['	<widget class="GtkVBox" id="vbox1">\n']
  templatebuf+= ['	  <property name="visible">True</property>\n']
  templatebuf+= ['	  <property name="homogeneous">False</property>\n']
  templatebuf+= ['	  <property name="spacing">0</property>\n']
  templatebuf+= ['\n']
  templatebuf+= ['	  <child>\n']
  templatebuf+= ['	    <widget class="GtkVBox" id="vbox2">\n']
  templatebuf+= ['	      <property name="visible">True</property>\n']
  templatebuf+= ['	      <property name="homogeneous">False</property>\n']
  templatebuf+= ['	      <property name="spacing">7</property>\n']
  templatebuf+= ['\n']
  templatebuf+= ['	      <child>\n']
  templatebuf+= ['		<widget class="GtkHBox" id="hbox1">\n']
  templatebuf+= ['		  <property name="visible">True</property>\n']
  templatebuf+= ['		  <property name="homogeneous">False</property>\n']
  templatebuf+= ['		  <property name="spacing">0</property>\n']
  templatebuf+= ['\n']
  templatebuf+= ['		  <child>\n']
  templatebuf+= ['		    <widget class="GtkLabel" id="label1">\n']
  templatebuf+= ['		      <property name="visible">True</property>\n']
  templatebuf+= ['		      <property name="label" translatable="yes">Hostname: </property>\n']
  templatebuf+= ['		      <property name="use_underline">False</property>\n']
  templatebuf+= ['		      <property name="use_markup">False</property>\n']
  templatebuf+= ['		      <property name="justify">GTK_JUSTIFY_LEFT</property>\n']
  templatebuf+= ['		      <property name="wrap">False</property>\n']
  templatebuf+= ['		      <property name="selectable">False</property>\n']
  templatebuf+= ['		      <property name="xalign">0.5</property>\n']
  templatebuf+= ['		      <property name="yalign">0.5</property>\n']
  templatebuf+= ['		      <property name="xpad">0</property>\n']
  templatebuf+= ['		      <property name="ypad">0</property>\n']
  templatebuf+= ['		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>\n']
  templatebuf+= ['		      <property name="width_chars">-1</property>\n']
  templatebuf+= ['		      <property name="single_line_mode">False</property>\n']
  templatebuf+= ['		      <property name="angle">0</property>\n']
  templatebuf+= ['		    </widget>\n']
  templatebuf+= ['		    <packing>\n']
  templatebuf+= ['		      <property name="padding">0</property>\n']
  templatebuf+= ['		      <property name="expand">False</property>\n']
  templatebuf+= ['		      <property name="fill">False</property>\n']
  templatebuf+= ['		    </packing>\n']
  templatebuf+= ['		  </child>\n']
  templatebuf+= ['\n']
  templatebuf+= ['		  <child>\n']
  templatebuf+= ['		    <widget class="GtkEntry" id="entry1">\n']
  templatebuf+= ['		      <property name="visible">True</property>\n']
  templatebuf+= ['		      <property name="can_focus">True</property>\n']
  templatebuf+= ['		      <property name="editable">True</property>\n']
  templatebuf+= ['		      <property name="visibility">True</property>\n']
  templatebuf+= ['		      <property name="max_length">0</property>\n']
  templatebuf+= ['		      <property name="text" translatable="yes">127.0.0.1</property>\n']
  templatebuf+= ['		      <property name="has_frame">True</property>\n']
  templatebuf+= ['		      <property name="invisible_char">*</property>\n']
  templatebuf+= ['		      <property name="activates_default">False</property>\n']
  templatebuf+= ['		    </widget>\n']
  templatebuf+= ['		    <packing>\n']
  templatebuf+= ['		      <property name="padding">0</property>\n']
  templatebuf+= ['		      <property name="expand">True</property>\n']
  templatebuf+= ['		      <property name="fill">True</property>\n']
  templatebuf+= ['		    </packing>\n']
  templatebuf+= ['		  </child>\n']
  templatebuf+= ['		</widget>\n']
  templatebuf+= ['		<packing>\n']
  templatebuf+= ['		  <property name="padding">0</property>\n']
  templatebuf+= ['		  <property name="expand">True</property>\n']
  templatebuf+= ['		  <property name="fill">True</property>\n']
  templatebuf+= ['		</packing>\n']
  templatebuf+= ['	      </child>\n']
  templatebuf+= ['\n']
  templatebuf+= ['	      <child>\n']
  templatebuf+= ['		<widget class="GtkHBox" id="hbox2">\n']
  templatebuf+= ['		  <property name="visible">True</property>\n']
  templatebuf+= ['		  <property name="homogeneous">False</property>\n']
  templatebuf+= ['		  <property name="spacing">28</property>\n']
  templatebuf+= ['\n']
  templatebuf+= ['		  <child>\n']
  templatebuf+= ['		    <widget class="GtkLabel" id="label2">\n']
  templatebuf+= ['		      <property name="visible">True</property>\n']
  templatebuf+= ['		      <property name="label" translatable="yes">Port: </property>\n']
  templatebuf+= ['		      <property name="use_underline">False</property>\n']
  templatebuf+= ['		      <property name="use_markup">False</property>\n']
  templatebuf+= ['		      <property name="justify">GTK_JUSTIFY_LEFT</property>\n']
  templatebuf+= ['		      <property name="wrap">False</property>\n']
  templatebuf+= ['		      <property name="selectable">False</property>\n']
  templatebuf+= ['		      <property name="xalign">0.5</property>\n']
  templatebuf+= ['		      <property name="yalign">0.5</property>\n']
  templatebuf+= ['		      <property name="xpad">0</property>\n']
  templatebuf+= ['		      <property name="ypad">0</property>\n']
  templatebuf+= ['		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>\n']
  templatebuf+= ['		      <property name="width_chars">-1</property>\n']
  templatebuf+= ['		      <property name="single_line_mode">False</property>\n']
  templatebuf+= ['		      <property name="angle">0</property>\n']
  templatebuf+= ['		    </widget>\n']
  templatebuf+= ['		    <packing>\n']
  templatebuf+= ['		      <property name="padding">0</property>\n']
  templatebuf+= ['		      <property name="expand">False</property>\n']
  templatebuf+= ['		      <property name="fill">False</property>\n']
  templatebuf+= ['		    </packing>\n']
  templatebuf+= ['		  </child>\n']
  templatebuf+= ['\n']
  templatebuf+= ['		  <child>\n']
  templatebuf+= ['		    <widget class="GtkSpinButton" id="spinbutton1">\n']
  templatebuf+= ['		      <property name="visible">True</property>\n']
  templatebuf+= ['		      <property name="can_focus">True</property>\n']
  templatebuf+= ['		      <property name="climb_rate">1</property>\n']
  templatebuf+= ['		      <property name="digits">0</property>\n']
  templatebuf+= ['		      <property name="numeric">False</property>\n']
  templatebuf+= ['		      <property name="update_policy">GTK_UPDATE_ALWAYS</property>\n']
  templatebuf+= ['		      <property name="snap_to_ticks">False</property>\n']
  templatebuf+= ['		      <property name="wrap">False</property>\n']
  templatebuf+= ['		      <property name="adjustment">80 0 65535 1 10 10</property>\n']
  templatebuf+= ['		    </widget>\n']
  templatebuf+= ['		    <packing>\n']
  templatebuf+= ['		      <property name="padding">0</property>\n']
  templatebuf+= ['		      <property name="expand">True</property>\n']
  templatebuf+= ['		      <property name="fill">True</property>\n']
  templatebuf+= ['		    </packing>\n']
  templatebuf+= ['		  </child>\n']
  templatebuf+= ['		</widget>\n']
  templatebuf+= ['		<packing>\n']
  templatebuf+= ['		  <property name="padding">0</property>\n']
  templatebuf+= ['		  <property name="expand">True</property>\n']
  templatebuf+= ['		  <property name="fill">True</property>\n']
  templatebuf+= ['		</packing>\n']
  templatebuf+= ['	      </child>\n']
  templatebuf+= ['	    </widget>\n']
  templatebuf+= ['	    <packing>\n']
  templatebuf+= ['	      <property name="padding">0</property>\n']
  templatebuf+= ['	      <property name="expand">False</property>\n']
  templatebuf+= ['	      <property name="fill">True</property>\n']
  templatebuf+= ['	    </packing>\n']
  templatebuf+= ['	  </child>\n']
  templatebuf+= ['\n']
  templatebuf+= ['	  <child>\n']
  templatebuf+= ['	    <widget class="GtkHSeparator" id="hseparator1">\n']
  templatebuf+= ['	      <property name="visible">True</property>\n']
  templatebuf+= ['	    </widget>\n']
  templatebuf+= ['	    <packing>\n']
  templatebuf+= ['	      <property name="padding">5</property>\n']
  templatebuf+= ['	      <property name="expand">False</property>\n']
  templatebuf+= ['	      <property name="fill">True</property>\n']
  templatebuf+= ['	    </packing>\n']
  templatebuf+= ['	  </child>\n']
  templatebuf+= ['\n']
  templatebuf+= ['	  <child>\n']
  templatebuf+= ['	    <widget class="GtkVBox" id="vbox2edit">\n']
  templatebuf+= ['	      <property name="visible">True</property>\n']
  templatebuf+= ['	      <property name="homogeneous">False</property>\n']
  templatebuf+= ['	      <property name="spacing">0</property>\n']
  templatebuf+= ['\n']
  templatebuf+= ['	      <child>\n']
  templatebuf+= ['		<widget class="GtkHBox" id="hbox3">\n']
  templatebuf+= ['		  <property name="visible">True</property>\n']
  templatebuf+= ['		  <property name="homogeneous">False</property>\n']
  templatebuf+= ['		  <property name="spacing">0</property>\n']
  templatebuf+= ['\n']
  templatebuf+= ['		  <child>\n']
  templatebuf+= ['		    <widget class="GtkLabel" id="label3">\n']
  templatebuf+= ['		      <property name="visible">True</property>\n']
  templatebuf+= ['		      <property name="label" translatable="yes">Versions: </property>\n']
  templatebuf+= ['		      <property name="use_underline">False</property>\n']
  templatebuf+= ['		      <property name="use_markup">False</property>\n']
  templatebuf+= ['		      <property name="justify">GTK_JUSTIFY_LEFT</property>\n']
  templatebuf+= ['		      <property name="wrap">False</property>\n']
  templatebuf+= ['		      <property name="selectable">False</property>\n']
  templatebuf+= ['		      <property name="xalign">0.5</property>\n']
  templatebuf+= ['		      <property name="yalign">0.5</property>\n']
  templatebuf+= ['		      <property name="xpad">0</property>\n']
  templatebuf+= ['		      <property name="ypad">0</property>\n']
  templatebuf+= ['		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>\n']
  templatebuf+= ['		      <property name="width_chars">-1</property>\n']
  templatebuf+= ['		      <property name="single_line_mode">False</property>\n']
  templatebuf+= ['		      <property name="angle">0</property>\n']
  templatebuf+= ['		    </widget>\n']
  templatebuf+= ['		    <packing>\n']
  templatebuf+= ['		      <property name="padding">0</property>\n']
  templatebuf+= ['		      <property name="expand">False</property>\n']
  templatebuf+= ['		      <property name="fill">False</property>\n']
  templatebuf+= ['		    </packing>\n']
  templatebuf+= ['		  </child>\n']
  templatebuf+= ['\n']
  templatebuf+= ['		  <child>\n']
  templatebuf+= ['		    <widget class="GtkVBox" id="vbox3">\n']
  templatebuf+= ['		      <property name="visible">True</property>\n']
  templatebuf+= ['		      <property name="homogeneous">False</property>\n']
  templatebuf+= ['		      <property name="spacing">0</property>\n']
  templatebuf+= ['\n']
  templatebuf+= createTargetButtons(targets)  
  templatebuf+= ['\n']
  templatebuf+= ['		      <child>\n']
  templatebuf+= ['			<placeholder/>\n']
  templatebuf+= ['		      </child>\n']
  templatebuf+= ['		    </widget>\n']
  templatebuf+= ['		    <packing>\n']
  templatebuf+= ['		      <property name="padding">0</property>\n']
  templatebuf+= ['		      <property name="expand">True</property>\n']
  templatebuf+= ['		      <property name="fill">True</property>\n']
  templatebuf+= ['		    </packing>\n']
  templatebuf+= ['		  </child>\n']
  templatebuf+= ['		</widget>\n']
  templatebuf+= ['		<packing>\n']
  templatebuf+= ['		  <property name="padding">0</property>\n']
  templatebuf+= ['		  <property name="expand">True</property>\n']
  templatebuf+= ['		  <property name="fill">True</property>\n']
  templatebuf+= ['		</packing>\n']
  templatebuf+= ['	      </child>\n']
  templatebuf+= ['	    </widget>\n']
  templatebuf+= ['	    <packing>\n']
  templatebuf+= ['	      <property name="padding">0</property>\n']
  templatebuf+= ['	      <property name="expand">True</property>\n']
  templatebuf+= ['	      <property name="fill">True</property>\n']
  templatebuf+= ['	    </packing>\n']
  templatebuf+= ['	  </child>\n']
  templatebuf+= ['	</widget>\n']
  templatebuf+= ['	<packing>\n']
  templatebuf+= ['	  <property name="padding">0</property>\n']
  templatebuf+= ['	  <property name="expand">True</property>\n']
  templatebuf+= ['	  <property name="fill">True</property>\n']
  templatebuf+= ['	</packing>\n']
  templatebuf+= ['      </child>\n']
  templatebuf+= ['    </widget>\n']
  templatebuf+= ['  </child>\n']
  templatebuf+= ['</widget>\n']
  templatebuf+= ['\n']
  templatebuf+= ['</glade-interface>\n']


  for a in templatebuf:
      f.write(a)
  f.close()
  

def createTargetButtons(targets):
  templatebuf=[]
  for a in targets:
    templatebuf+= ['			<child>\n']
    templatebuf+= ['			<widget class="GtkRadioButton" id="radiobutton%s">\n' %str(a+1)]
    templatebuf+= ['			  <property name="visible">True</property>\n']
    templatebuf+= ['			  <property name="can_focus">True</property>\n']
    templatebuf+= ['			  <property name="label" translatable="yes">%s</property>\n'%str(targets[a][0])]
    templatebuf+= ['			  <property name="use_underline">True</property>\n']
    templatebuf+= ['			  <property name="relief">GTK_RELIEF_NORMAL</property>\n']
    templatebuf+= ['			  <property name="focus_on_click">True</property>\n']
    templatebuf+= ['			  <property name="active">False</property>\n']
    templatebuf+= ['			  <property name="inconsistent">False</property>\n']
    templatebuf+= ['			  <property name="draw_indicator">True</property>\n']
    templatebuf+= ['			</widget>\n']
    templatebuf+= ['			<packing>\n']
    templatebuf+= ['			  <property name="padding">0</property>\n']
    templatebuf+= ['			  <property name="expand">False</property>\n']
    templatebuf+= ['			  <property name="fill">False</property>\n']
    templatebuf+= ['			</packing>\n']
    templatebuf+= ['			</child>\n']
  return templatebuf