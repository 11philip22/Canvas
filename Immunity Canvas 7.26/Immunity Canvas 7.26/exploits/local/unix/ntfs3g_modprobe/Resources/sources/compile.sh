#!/bin/sh
make clean
gcc -o exploit_CVE-2017-0358 exploit_CVE-2017-0358.c -Wall -std=gnu99 -g3
make -C /lib/modules/$(uname -r)/build M=$(pwd) modules

mkdir -p depmod_tmp/lib/modules/$(uname -r)
cp fakemodule.ko depmod_tmp/lib/modules/$(uname -r)/
touch depmod_tmp/lib/modules/$(uname -r)/modules.order
touch depmod_tmp/lib/modules/$(uname -r)/modules.builtin

/sbin/depmod -b depmod_tmp/
cp depmod_tmp/lib/modules/$(uname -r)/*.bin .
rm -rf depmod_tmp

