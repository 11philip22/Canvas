#! /usr/bin/env python

#Proprietary CANVAS source code - use only under the license agreement
#specified in LICENSE.txt in your CANVAS distribution
#Copyright Immunity, Inc, 2002-2008
#http://www.immunityinc.com/CANVAS/ for more information

import sys
if '.' not in sys.path:
    sys.path.append('.')


from exploitutils import *
from canvasexploit import canvasexploit
from ExploitTypes.localcommand import LocalCommand

NAME                    = "exitthread"
DESCRIPTION             = "Exit the current thread"
VERSION                 = "1.0"
DOCUMENTATION           = {}
PROPERTY                = {}
PROPERTY['TYPE']        = "Commands"
PROPERTY['SITE']        = "Local"
PROPERTY['ARCH']        = [ ["Windows"] ]

class theexploit(LocalCommand):
    def __init__(self):
        LocalCommand.__init__(self)
        self.result     = ""
        self.exitcode   = 0

    def getargs(self):
        self.exitcode = self.argsDict.get("exitcode", self.exitcode)
        return

    def run(self):
        self.setInfo("%s (in progress)" % (NAME))
        self.getargs()

        for node in self.argsDict["passednodes"]:
            if hasattr(node.shell, 'ExitThread'):
                self.result = node.shell.ExitThread(self.exitcode) 
            
        self.setInfo("%s - (finished)" % (NAME))
        return 1
    

