#! /usr/bin/env python

"""

TFTP Fuzzer 

"""

import traceback
import sys
if "." not in sys.path:
    sys.path.append('.')
import os , dircache
import time

from exploitutils import *
from fuzzers.spike import *

from canvasexploit import *



NAME="tftp fuzzer"
DESCRIPTION="Fuzzer for TFTP Servers"
DOCUMENTATION={}
DOCUMENTATION["Repeatability"]="Infinite - fuzzer"
DOCUMENTATION["Date public"] = "N/A"

VERSION="1.0"

PROPERTY = {}
PROPERTY['TYPE'] = "Fuzzers"

class theexploit(canvasexploit):
    def __init__(self):
        canvasexploit.__init__(self)
        self.filename=""
        self.user=""
        self.password=""
        self.port=69
        self.name=NAME
        return 

    def getargs(self):
        self.host=self.target.interface

        self.getarg("filename")
        self.getarg("user")
        self.getarg("password")
        return 
    
    def run(self):
        self.getargs()
        #get all spike scripts we currently have with tftp*.spk
        dirlist=dircache.listdir("fuzzers/SPIKESCRIPTS/")
        spikescripts=[]
        for s in dirlist:
            if s.startswith("tftp"):
                spikescripts+=[s]
            
        for scriptname in spikescripts:
            if self.state==self.HALT:
                self.log("Halted")
                return 1
            run_on_target(self.host, self.port, scriptname, protocol="UDP")
            
        #we ran so we succeeded :>
        return 1
    
if __name__=="__main__":
    app=theexploit()
    ret=standard_callback_commandline(app)
    if ret not in [0,1,None] and hasattr(ret,'interact'):
        ret.interact()
