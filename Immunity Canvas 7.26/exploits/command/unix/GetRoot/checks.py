#! /usr/bin/env python

#Proprietary CANVAS source code - use only under the license agreement
#specified in LICENSE.txt in your CANVAS distribution
#Copyright Immunity, Inc, 2002-2004
#http://www.immunityinc.com/CANVAS/ for more information

import sys
#covers both angles
if "." not in sys.path:
    sys.path.append(".")

import os,getopt
import socket
import canvasengine
from datetime import datetime
import logging

from exploitutils import *
from canvasexploit import canvasexploit

def is_euid(node_info, node_euid):
    if "euid" not in node_info:
        logging.error("Key 'euid' not in node_info.")
        raise KeyError
        return False
    if node_info["euid"] != node_euid:
        return False
    else:
        return True

def generic_false(node_info):
    return False

def is_uname(node_info, value, target_value):
    return target_value.lower() in node_info[value].lower()

def is_release_between(node_info, date_from, date_to):
    version_array = node_info["version"].split(" ")
    kdate = None
    for i in range(0, len(version_array)-4):
        test_string = version_array[i] + " " + version_array[i+1] + " " + version_array[i+4]
        try:
            kdate = datetime.strptime(test_string, "%b %d %Y")
        except:
            pass
    if kdate is None:
        return False

    kdatefrom = datetime.strptime(date_from, "%Y%m%d")
    kdateto = datetime.strptime(date_to, "%Y%m%d")
    
    if kdatefrom <= kdate <= kdateto:
        return True
    return False
