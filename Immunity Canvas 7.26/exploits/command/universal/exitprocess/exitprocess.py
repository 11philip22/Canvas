#! /usr/bin/env python

#Proprietary CANVAS source code - use only under the license agreement
#specified in LICENSE.txt in your CANVAS distribution
#Copyright Immunity, Inc, 2002-2008
#http://www.immunityinc.com/CANVAS/ for more information

import sys
if '.' not in sys.path:
    sys.path.append('.')

from exploitutils import *
from canvasexploit import canvasexploit
from ExploitTypes.localcommand import LocalCommand

NAME                    = "exitprocess"
DESCRIPTION             = "Exit the process"
VERSION                 = "1.0"

DOCUMENTATION           = {}

PROPERTY                = {}
PROPERTY['TYPE']        = "Commands"
PROPERTY['SITE']        = "Local"
PROPERTY['ARCH']        = [ ["Unix"], ["Windows"] ]


class theexploit(LocalCommand):
    def __init__(self):
        LocalCommand.__init__(self)
        self.result     = ""
        self.exitcode   = 0

    def getargs(self):
        self.exitcode = self.argsDict.get("exitcode", self.exitcode)

    def run(self):
        self.setInfo("%s (in progress)" % (NAME))
        self.getargs()

        for node in self.argsDict["passednodes"]:
            type = node.nodetype
            # better way than the supported node array ..
            if hasattr(node.shell, 'exit'):
                self.result = node.shell.exit(self.exitcode)
            else:
                self.log("%s node type not supported" % type)
                continue

        self.setInfo("%s - (finished)"%(NAME))
        return 1

